#!/bin/execlineb -S0

# stolen and modified from /etc/s6/init/init-stage2 to rerun fix-attrs

foreground
{
  if
  {
    if -t { s6-test -d /var/run/s6/etc/fix-attrs.d }
    if { s6-echo "[fix-attrs.d] applying ownership & permissions fixes..." }
    if
    {
      pipeline { s6-ls -0 -- /var/run/s6/etc/fix-attrs.d }
      pipeline { s6-sort -0 -- }
      forstdin -0 -- i
      importas -u i i
      if { s6-echo -- "[fix-attrs.d] ${i}: applying... " }
      foreground { redirfd -r 0 /var/run/s6/etc/fix-attrs.d/${i} fix-attrs }
      importas -u ? ?
      if { s6-echo -- "[fix-attrs.d] ${i}: exited ${?}." }
      exit ${?}
    }
  }
}

